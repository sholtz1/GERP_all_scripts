First run all poolseq to allelefrq 

Files found in the Pooledseq_to_allelefrq folder
Steps described in the alnpoolsREADME

Second run all gerp scripts

Files found in the GERP_scripts folder
Steps described in the  GERP_Pipeline_README



Finally run R data formatting pipeline described below

Files found in the R_data_formatting folder


Pipeline to combine fitness, allele frequency, and GERP data, and Grantham score data for final analyses.


Required Scripts(All R scrips run in R version 4.1.1 (2021-08-10))

Format_allele_frqs_ancestral_final.R 
combine_newgerp.R
Format_ensemble_vep.R
Ensembal Metazoa (online resource)
Variant_effects_derived.R
Format_beetle_fitness.R
formatting_final_summary_derived.R
final_analyses.R






### Allele frequencies ###

starting file "Allele_frequencies.delim"
run Rscript Format_allele_frqs_ancestral_final.R 
This script takes the number of neucleotides in each pooled genetic sample turns this into allele frequencies
Final file "Derived_FRQs.delim"

### Combine with GERP scores ####

starting file "Derived_FRQs.delim"
run Rscript combine_newgerp.R
This scipt joins the GERP data with the allele frequency data based on chromosome and location
Final file ""Full_data_newgerp.delim""

### Generate a file to run in Ensembl VEP####
starting file "Allele_frequencies.delim""
run Rscript Format_ensemble_vep.R
This script generates a file in the exact format needed to use with the online Enselbl VEP program.
Final file  "Ensembal_VEP.delim"
First column is the chromosome 
Second two are the location of the SNP 
Fourth is the amino acid change
Fifth is the strand that the change occurs on
Column headers cant be present

LGX	26771	26771	T/G	+
LGX	37263	37263	A/G	-
LGX	49592	49592	T/G	-
LGX	65195	65195	A/T	-
LGX	68788	68788	T/G	-
LGX	88053	88053	G/A	+


######## Run ensembl VEP ############
starting file "Ensembal_VEP.delim"
Using the website https://metazoa.ensembl.org/Tribolium_castaneum/Tools/VEP
Run using default settings
output file will have a random name generated by ensembl


###### calculate loads based on grantham scores ####
starting files "Full_data_newgerp.delim" and output file from Ensembl VEP
run Rscript Variant_effects.R
This will take the amino acid changes identified by Ensembl VEP for each location in the genome and create a grantham score for it
It will then use those grantham scores to calculate a measure of genetic load for each Landscape and treatment.
Final file "Grantham_GERP_derived.delim"

###Beetle Fitness#####

Starting file "F2_census.csv"
run Rscript Format_beetle_fitness.R
This script calculates fitness from growth rate data. 
Final file "Beetle_fitness_filtered.delim" 

####### Format final summary statistics we will use in the final models #######
Starting files "Beetle_fitness_filtered.delim", "Full_data_newgerp.delim", and "Grantham_GERP_derived.delim"
Run Rscript formatting_final_summary_derived.R
This script takes all of the GERP and allele frequency information and calculates different summary stats
for each landscape and treatment and attaches that to our fitness data. This data can then be used to compare population level
genetic loads and allele frequency changes to the finesses of populations
Final file "Final_summary.delim"


###### generate a final model and create figures ##########
final model fitting and figure creation are all done in R using the Rscript Final_final_analyses.R

